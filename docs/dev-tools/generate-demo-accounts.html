<!DOCTYPE html>
<html>
<head>
    <title>Generate 5 Valid Demo Accounts</title>
    <script src="https://unpkg.com/nostr-tools/lib/nostr.bundle.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .account { background: #2a2a2a; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .key { background: #0f0f0f; padding: 8px; border-radius: 4px; font-family: monospace; word-break: break-all; margin: 5px 0; font-size: 12px; }
        button { padding: 10px 20px; background: #6b46c1; color: white; border: none; border-radius: 5px; margin: 5px; }
        .config-output { background: #1a1a1a; border: 1px solid #444; padding: 15px; border-radius: 8px; margin: 15px 0; }
    </style>
</head>
<body>
    <h2>🔑 Generate 5 Valid Demo Accounts</h2>
    <button onclick="generateAllAccounts()">Generate New Valid Demo Accounts</button>
    
    <div id="accounts"></div>
    
    <div id="config-section" style="display:none;">
        <h3>🔧 Updated config.js AUTHORIZED_MEMBERS:</h3>
        <div class="config-output">
            <pre id="config-output"></pre>
        </div>
        <button onclick="copyConfig()">📋 Copy config.js Code</button>
        
        <h3>📝 Updated DEMO-ACCOUNTS.md:</h3>
        <div class="config-output">
            <pre id="demo-accounts-output"></pre>
        </div>
        <button onclick="copyDemoAccounts()">📋 Copy DEMO-ACCOUNTS.md</button>
    </div>

    <script>
        let generatedAccounts = [];
        
        function generateAllAccounts() {
            const names = ['Demo User', 'Alice Bitcoin', 'Bob Lightning', 'Charlie Hodler', 'Diana Trader'];
            const accountsDiv = document.getElementById('accounts');
            
            accountsDiv.innerHTML = '<h3>Generating...</h3>';
            generatedAccounts = [];
            
            try {
                for (let i = 0; i < 5; i++) {
                    console.log(\`Generating account \${i + 1}: \${names[i]}\`);
                    
                    // Generate proper private key
                    const privateKey = window.NostrTools.generatePrivateKey();
                    
                    // Encode to nsec and npub
                    const nsec = window.NostrTools.nip19.nsecEncode(privateKey);
                    const publicKey = window.NostrTools.getPublicKey(privateKey);
                    const npub = window.NostrTools.nip19.npubEncode(publicKey);
                    
                    // Verify by decoding (this will throw if invalid)
                    window.NostrTools.nip19.decode(nsec);
                    window.NostrTools.nip19.decode(npub);
                    
                    const account = {
                        name: names[i],
                        nsec: nsec,
                        npub: npub,
                        privateKey: privateKey,
                        publicKey: publicKey
                    };
                    
                    generatedAccounts.push(account);
                    console.log(\`✅ Generated \${names[i]}:\`, account);
                }
                
                displayAccounts();
                generateConfigCode();
                
            } catch (error) {
                console.error('❌ Error generating accounts:', error);
                accountsDiv.innerHTML = \`<p style="color:red;">Error: \${error.message}</p>\`;
            }
        }
        
        function displayAccounts() {
            const accountsDiv = document.getElementById('accounts');
            
            accountsDiv.innerHTML = '<h3>✅ Generated Valid Demo Accounts:</h3>';
            
            generatedAccounts.forEach((account, index) => {
                accountsDiv.innerHTML += \`
                    <div class="account">
                        <h4>👤 \${account.name}</h4>
                        <p><strong>nsec (Private Key):</strong></p>
                        <div class="key">\${account.nsec}</div>
                        <p><strong>npub (Public Key):</strong></p>
                        <div class="key">\${account.npub}</div>
                        <button onclick="copyKey('\${account.nsec}')">📋 Copy nsec</button>
                        <button onclick="copyKey('\${account.npub}')">📋 Copy npub</button>
                    </div>
                \`;
            });
        }
        
        function generateConfigCode() {
            // Generate config.js code
            const configLines = generatedAccounts.map(acc => 
                \`    '\${acc.npub}',  // \${acc.name}\`
            ).join('\\n');
            
            const configCode = \`    // 🎯 DEMO ACCOUNTS - echte gültige Test-Accounts
\${configLines}\`;
            
            document.getElementById('config-output').textContent = configCode;
            
            // Generate DEMO-ACCOUNTS.md
            let demoAccountsContent = \`# 🔑 Demo Accounts für Bitcoin-Tausch-Netzwerk

Diese Demo-Accounts sind bereits in der \\\`config.js\\\` als autorisierte Mitglieder eingetragen:

\`;
            
            generatedAccounts.forEach((account, index) => {
                demoAccountsContent += \`## 👤 \${account.name}
- **nsec:** \\\`\${account.nsec}\\\`
- **npub:** \\\`\${account.npub}\\\`

\`;
            });
            
            demoAccountsContent += \`---

## 🚀 Anleitung:

1. **Server starten:** \\\`cd docs && python3 -m http.server 8001\\\`
2. **Login-Seite öffnen:** http://localhost:8001/start.html  
3. **Einen der nsec oben eingeben** und anmelden
4. **Dashboard testen:** Bitcoin-Angebote durchstöbern
5. **Meine Angebote:** Interesse-Management testen

Die Login-Validierung erfolgt über die \\\`config.js\\\` AUTHORIZED_MEMBERS Liste.\`;
            
            document.getElementById('demo-accounts-output').textContent = demoAccountsContent;
            document.getElementById('config-section').style.display = 'block';
        }
        
        function copyKey(key) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(key).then(() => {
                    alert('✅ Key copied!');
                });
            } else {
                prompt('Copy this key:', key);
            }
        }
        
        function copyConfig() {
            const configText = document.getElementById('config-output').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(configText).then(() => {
                    alert('✅ Config code copied!');
                });
            } else {
                prompt('Copy this config code:', configText);
            }
        }
        
        function copyDemoAccounts() {
            const demoText = document.getElementById('demo-accounts-output').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(demoText).then(() => {
                    alert('✅ DEMO-ACCOUNTS.md copied!');
                });
            } else {
                prompt('Copy this content:', demoText);
            }
        }
        
        // Auto-generate on load
        window.onload = () => generateAllAccounts();
    </script>
</body>
</html>
