<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin-Tausch-Gruppe | Private Community</title>
    <meta name="description" content="Private Bitcoin-Handels-Community - Nur mit Einladungslink zug√§nglich">
    
    <!-- üé® STYLES -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- üî§ FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- üîó ICONS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- üîê NOSTR LIBRARIES -->
    <script src="https://unpkg.com/nostr-tools@2.1.0/lib/nostr.bundle.js"></script>
    <script src="https://unpkg.com/@nostrband/nostr-login@1.0.0/dist/unpkg.js"></script>
</head>
<body>
    <!-- üîê PRIVATE ACCESS BANNER -->
    <div class="private-banner bg-warning bg-opacity-10 border-bottom border-warning">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between py-2">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-shield-lock text-warning"></i>
                    <span class="text-warning fw-semibold">Private Gruppe</span>
                    <span class="text-muted">‚Ä¢</span>
                    <span class="text-muted">Nur mit Einladung</span>
                </div>
                <div id="groupStats" class="text-sm text-muted">
                    <!-- Wird dynamisch gef√ºllt -->
                </div>
            </div>
        </div>
    </div>

    <!-- üì± HEADER -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="#" class="logo">
                    <i class="bi bi-people-fill"></i>
                    Bitcoin-Tausch-Gruppe
                </a>
                <div class="nav-actions">
                    <div class="status-indicator" id="connectionStatus">
                        <div class="status-dot connecting"></div>
                        <span>Verbinde...</span>
                    </div>
                    <button id="loginBtn" class="btn btn-primary btn-sm">
                        <i class="bi bi-box-arrow-in-right"></i>
                        Anmelden
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- üöÄ MAIN CONTENT -->
    <main>
        <!-- DEMO BANNER (zeigt aktuellen Invite-Code) -->
        <div id="demoBanner" class="bg-info bg-opacity-10 border-bottom border-info">
            <div class="container">
                <div class="py-3 text-center">
                    <div class="d-flex align-items-center justify-content-center gap-3">
                        <i class="bi bi-info-circle text-info"></i>
                        <div>
                            <strong>DEMO:</strong> Dein Invite-Code ist <code id="currentInviteCode">BTN_DEMO123</code>
                            <br>
                            <small class="text-muted">
                                Teile diesen Link: 
                                <span id="fullInviteLink" class="text-primary fw-mono">
                                    https://walpurga03.github.io/Bitcoin-Tausch-Netzwerk/group.html#join/BTN_DEMO123
                                </span>
                            </small>
                        </div>
                        <button id="copyDemoLink" class="btn btn-outline-info btn-sm">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- INVITE SCREEN (f√ºr nicht-Mitglieder) -->
        <section id="inviteScreen" class="hero text-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="card glass p-4">
                            <div class="text-center mb-4">
                                <i class="bi bi-shield-check display-1 text-gradient mb-3"></i>
                                <h1 class="h3 text-gradient mb-3">Du wurdest eingeladen!</h1>
                                <div class="badge bg-primary bg-opacity-20 text-primary mb-3">
                                    Invite-Code: <span id="displayInviteCode">BTN_DEMO123</span>
                                </div>
                            </div>
                            
                            <p class="text-muted mb-4">
                                Tritt unserer privaten Bitcoin-Handels-Community bei. 
                                Hier lernst du vertrauensvolle Handelspartner kennen.
                            </p>
                            
                            <!-- USER JOURNEY STEPS -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center gap-2 mb-2 text-sm text-muted">
                                    <span class="badge bg-secondary">1</span>
                                    <span>Mit Nostr-Wallet anmelden</span>
                                </div>
                                <div class="d-flex align-items-center gap-2 mb-2 text-sm text-muted">
                                    <span class="badge bg-secondary">2</span>
                                    <span>Spitznamen w√§hlen</span>
                                </div>
                                <div class="d-flex align-items-center gap-2 mb-3 text-sm text-muted">
                                    <span class="badge bg-secondary">3</span>
                                    <span>Gruppe beitreten & vorstellen</span>
                                </div>
                            </div>
                            
                            <!-- Wallet-Anmeldung -->
                            <div id="walletStep" class="mb-4">
                                <h6 class="text-start mb-3">üîê Schritt 1: Anmeldung</h6>
                                <div class="d-grid gap-2">
                                    <button id="walletLoginBtn" class="btn btn-primary">
                                        <i class="bi bi-wallet2"></i>
                                        Mit Alby/nos2x anmelden
                                    </button>
                                    <button id="amberLoginBtn" class="btn btn-outline-primary">
                                        <i class="bi bi-phone"></i>
                                        Mit Amber (Mobile)
                                    </button>
                                    <button id="newKeyBtn" class="btn btn-outline-secondary">
                                        <i class="bi bi-key"></i>
                                        Neue Identit√§t erstellen
                                    </button>
                                </div>
                            </div>

                            <!-- Nickname-Eingabe (nach Login) -->
                            <div id="nicknameStep" class="mb-4" style="display: none;">
                                <h6 class="text-start mb-3">üë§ Schritt 2: Spitzname</h6>
                                <label class="form-label text-start d-block">W√§hle einen Spitznamen:</label>
                                <input type="text" id="nicknameInput" class="form-control mb-2" 
                                       placeholder="z.B. BitcoinMike123" maxlength="30">
                                <div class="text-sm text-muted text-start">
                                    3-30 Zeichen, nur Buchstaben, Zahlen, _ und -
                                </div>
                            </div>

                            <!-- Beitreten Button -->
                            <div id="joinStep" style="display: none;">
                                <h6 class="text-start mb-3">üöÄ Schritt 3: Beitreten</h6>
                                <button id="joinGroupBtn" class="btn btn-success w-100 mb-3" disabled>
                                    <i class="bi bi-people-fill"></i>
                                    Gruppe beitreten
                                </button>
                            </div>
                            
                            <div class="text-sm text-muted">
                                <i class="bi bi-info-circle"></i>
                                Nach dem Beitritt: Stelle dich vor und warte auf Admin-Verifikation
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- GROUP INTERFACE (f√ºr Mitglieder) -->
        <section id="groupInterface" style="display: none;">
            <!-- üìä GROUP HEADER -->
            <div class="container mt-4">
                <div class="row">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div class="avatar-circle">
                                <i class="bi bi-people"></i>
                            </div>
                            <div>
                                <h2 class="h4 mb-1" id="groupName">Bitcoin-Tausch-Gruppe</h2>
                                <div class="text-muted">
                                    <span id="memberCount">0</span> Mitglieder ‚Ä¢ 
                                    <span id="tradingStatus">Kennenlernphase</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button id="createInviteBtn" class="btn btn-outline-primary btn-sm me-2">
                            <i class="bi bi-link-45deg"></i>
                            Invite-Link
                        </button>
                        <button id="groupSettingsBtn" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-gear"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- üìã INTRODUCTION PANEL (f√ºr neue Mitglieder) -->
            <div id="introductionPanel" class="container mb-4" style="display: none;">
                <div class="alert alert-info">
                    <div class="d-flex align-items-start gap-3">
                        <i class="bi bi-person-waves"></i>
                        <div class="flex-fill">
                            <h6 class="alert-heading">Stelle dich der Gruppe vor!</h6>
                            <p class="mb-3">
                                Um Bitcoin-Angebote erstellen zu k√∂nnen, musst du dich zuerst vorstellen 
                                und vom Admin verifiziert werden.
                            </p>
                            <div class="form-group mb-3">
                                <textarea id="introductionText" class="form-control" rows="4"
                                          placeholder="Erz√§hle etwas √ºber dich: Woher kommst du? Wie lange handelst du mit Bitcoin? Was sind deine Ziele?"></textarea>
                            </div>
                            <button id="sendIntroductionBtn" class="btn btn-primary">
                                <i class="bi bi-send"></i>
                                Vorstellung senden
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üí¨ GROUP CHAT -->
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-chat-dots"></i>
                                    Gruppen-Chat
                                </h6>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" data-filter="all">Alle</button>
                                    <button class="btn btn-outline-secondary" data-filter="introductions">Vorstellungen</button>
                                    <button class="btn btn-outline-secondary" data-filter="general">Allgemein</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="groupMessages" class="chat-messages" style="height: 400px; overflow-y: auto;">
                                    <!-- Nachrichten werden hier eingef√ºgt -->
                                </div>
                                <div class="mt-3">
                                    <div class="input-group">
                                        <input type="text" id="messageInput" class="form-control" 
                                               placeholder="Nachricht schreiben...">
                                        <button id="sendMessageBtn" class="btn btn-primary">
                                            <i class="bi bi-send"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- üë• MEMBER LIST -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-people"></i>
                                    Mitglieder
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="membersList">
                                    <!-- Mitglieder werden hier eingef√ºgt -->
                                </div>
                            </div>
                        </div>

                        <!-- üîó INVITE LINK CARD -->
                        <div class="card mt-3" id="inviteLinkCard" style="display: none;">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-link-45deg"></i>
                                    Invite-Link
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="input-group">
                                    <input type="text" id="inviteLinkInput" class="form-control" readonly>
                                    <button id="copyInviteLinkBtn" class="btn btn-outline-secondary">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                                <div class="text-sm text-muted mt-2">
                                    Link ist 7 Tage g√ºltig
                                </div>
                            </div>
                        </div>

                        <!-- üöÄ TRADING PANEL (nur f√ºr verifizierte) -->
                        <div class="card mt-3" id="tradingPanel" style="display: none;">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-currency-bitcoin"></i>
                                    Bitcoin-Handel
                                </h6>
                            </div>
                            <div class="card-body text-center">
                                <div id="tradingDisabled">
                                    <i class="bi bi-clock-history display-4 text-muted mb-2"></i>
                                    <p class="text-muted">
                                        Handel wird nach der Kennenlernphase aktiviert
                                    </p>
                                </div>
                                <div id="tradingEnabled" style="display: none;">
                                    <button class="btn btn-success w-100 mb-2">
                                        <i class="bi bi-plus-circle"></i>
                                        Bitcoin-Angebot erstellen
                                    </button>
                                    <button class="btn btn-outline-primary w-100">
                                        <i class="bi bi-list"></i>
                                        Aktive Angebote
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- üîî NOTIFICATIONS -->
    <div id="notificationsContainer"></div>

    <!-- üì± SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="group-app.js"></script>
</body>
</html>
